## Codebase Patterns
- SDK exports are defined in `packages/0xtrails/src/index.ts` - check this file to see all public API
- Documentation uses Mintlify framework with `.mdx` files
- Run `npm test` to check for broken links (no typecheck in docs repo)
- Pre-existing broken link exists: `/api-reference/endpoints/get-intent-transaction-history` referenced in `examples/transaction-history.mdx`
- API definitions are in `trails-api/proto/trails-api.ridl` (main API) and `trails-api/proto/trails-onramp.ridl` (onramp)
- API uses webrpc format - `.ridl` files define service endpoints and types

---

## 2026-01-21 - US-001
- What was implemented: Audited trails SDK source code and created comprehensive gaps.md documenting undocumented features
- Files changed:
  - Created `gaps.md` - comprehensive audit of 45+ undocumented SDK exports
- **Learnings for future iterations:**
  - The SDK main entry point is `packages/0xtrails/src/index.ts` which re-exports from various modules
  - Widget-specific exports come from `widget/index.tsx`
  - Many useful utilities exist that developers don't know about (formatting, intent monitoring, chain utilities)
  - The docs repo uses Mintlify - no typecheck, but has `npm test` for broken link checking
  - There are pre-existing modified files in the repo that were not touched by this iteration
---

## 2026-01-21 - US-002
- What was implemented: Audited trails-api source code and updated gaps.md with undocumented API endpoints
- Files changed:
  - Updated `gaps.md` - added API documentation gaps section with 20+ undocumented endpoints
- **Learnings for future iterations:**
  - trails-api is a Go API using webrpc framework
  - API definitions live in `.ridl` files in `proto/` folder
  - Main service is `Trails` in `trails-api.ridl` with 22 endpoints (13 documented)
  - Onramp service is `TrailsOnramp` in `trails-onramp.ridl` with 11 endpoints (0 documented)
  - Admin service `TrailsAdmin` has 2 internal endpoints (should not be documented publicly)
  - Error codes are defined at the bottom of `trails-api.ridl`
  - The deprecated `GetIntentTransactionHistory` endpoint causes the pre-existing broken link
---

## 2026-01-21 - US-003
- What was implemented: Rewrote intro.mdx with compelling payments/stablecoin narrative
- Files changed:
  - Rewrote `intro.mdx` - payment-focused introduction with USDC code example
- **Learnings for future iterations:**
  - Mintlify supports `<CardGroup>` and `<Card>` components for grid layouts
  - Use `icon` prop on Cards (e.g., "credit-card", "wallet") for visual hierarchy
  - Tables work well for comparing challenges vs solutions - scannable format
  - Code snippets should show the simplest use case first (mode="pay" with USDC settlement)
  - Keep intro focused on the core value prop - detailed explanations belong in use-case pages
---

## 2026-01-21 - US-004
- What was implemented: Created llms.txt for AI-friendly documentation following the llms.txt standard
- Files changed:
  - Created `llms.txt` - structured overview of Trails for LLM consumption
- **Learnings for future iterations:**
  - llms.txt standard requires: H1 title, blockquote summary, H2 sections with file lists
  - Use `## Optional` section for secondary content that can be skipped for shorter context
  - Keep token count low (~600 tokens here) - include code snippets sparingly but show key patterns
  - Link format: `[Name](URL): Description` - concise one-line descriptions
  - Include API flow (QuoteIntent → CommitIntent → ExecuteIntent → WaitIntentReceipt) for API integrations
  - llms.txt lives at root of docs site and is fetched by AI tools for context
  - US-005 will need to reference this file in llm-integration.mdx
---

## 2026-01-21 - US-005
- What was implemented: Enhanced llm-integration.mdx with practical examples for AI agent developers
- Files changed:
  - Updated `resources/llm-integration.mdx` - comprehensive LLM integration guide with function calling
- **Learnings for future iterations:**
  - Mintlify supports `<AccordionGroup>` and `<Accordion>` components for collapsible best practices
  - Tool definitions for LLM function calling should follow OpenAI/Anthropic JSON schema format
  - Include both JSON tool definitions AND TypeScript implementation examples for completeness
  - Error handling section should map error codes to user-friendly messages for LLM to relay
  - System prompts should emphasize "always confirm before executing" for payment safety
  - User intent examples table format works well for showing natural language → function call mapping
  - Reference llms.txt at the top of the page since it's the primary AI context file
---

## 2026-01-21 - US-006
- What was implemented: Consolidated and improved pay use case documentation with stablecoin focus
- Files changed:
  - Rewrote `use-cases/pay.mdx` - comprehensive stablecoin payment guide
- **Learnings for future iterations:**
  - use-cases/*.mdx should focus on practical examples, sdk/modes/*.mdx should be technical reference
  - Removed duplicate content: basic payment and NFT examples were redundant with sdk/modes/pay.mdx
  - Tables are effective for showing "You Settle In / User Pays With / Trails Handles" comparisons
  - Merchant integration patterns should include both frontend (TrailsWidget) and backend (verifyPayment) code
  - Fee estimation section should show both useQuote hook (SDK) and QuoteIntent API (server-side) approaches
  - CCTP (Circle Cross-Chain Transfer Protocol) is the preferred bridge for native USDC transfers
  - CardGroup with cols={2} provides clean navigation cards at bottom of use-case pages
  - Stablecoin availability varies by chain - link to supported-chains page rather than hardcoding full list
---

## 2026-01-21 - US-007
- What was implemented: Updated SDK hooks documentation to match actual SDK exports
- Files changed:
  - Updated `sdk/hooks.mdx` - corrected hook names and types
- **Learnings for future iterations:**
  - The SDK exports `useIntentRecover` not `useTrailsRefund` - hook was renamed at some point
  - `useTokenBalancesForMultipleAccounts` returns `balancesByAccount` (object keyed by lowercase address), not `balances`
  - Each account in `balancesByAccount` has structure: `{ tokenBalancesData: { tokens: Token[] }, isLoading, error }`
  - Always verify hook return types against actual SDK source in `packages/0xtrails/src/index.ts`
  - The recovery hook automatically selects the intent address (origin or destination) with highest balance
  - `useIntentRecover` provides both manual flow (signPayload + getRecoverTx) and automatic flow (recover())
  - Pre-existing broken link in transaction-history.mdx references deprecated endpoint - don't worry about this
---

## 2026-01-21 - US-008
- What was implemented: Streamlined get-started.mdx to be a fast, no-fluff quickstart
- Files changed:
  - Rewrote `get-started.mdx` - bare essentials quickstart with npm install first
- **Learnings for future iterations:**
  - Quickstart pages should prioritize action over explanation - "Install" before "About"
  - Changed example from mode="fund" to mode="pay" since pay is the core payment use case
  - Use CardGroup with cols={3} for starter templates (compact 3-column layout)
  - Footer with inline links (using · separator) is effective for "full reference" section
  - Removed <Steps> component in favor of simple H2 sections for faster scanning
  - Keep code examples minimal but complete - just enough to copy-paste and run
---

## 2026-01-21 - US-009
- What was implemented: Added API authentication and error handling documentation to introduction.mdx
- Files changed:
  - Updated `api-reference/introduction.mdx` - added authentication, error codes, and rate limiting sections
- **Learnings for future iterations:**
  - API uses webrpc format - errors come as `webrpcError` object with code, name, message, cause, httpStatus
  - Error codes are defined in gaps.md (from trails-api.ridl): 2000-2004 (general), 7000-7001 (intents), 8000-8009 (resources), 9000 (service)
  - Quote validity is 5 minutes, then 10 minutes after CommitIntent to call ExecuteIntent
  - `X-Access-Key` header is the authentication mechanism (not Bearer token)
  - Mintlify supports `<Tip>` component for helpful hints alongside `<Note>` and `<Warning>`
  - Tables work well for error code documentation - scannable format with code, name, description, HTTP status
  - The pre-existing local changes in commit-intent.mdx, execute-intent.mdx, quote-intent.mdx were not part of US-009
---

## 2026-01-21 - US-010
- What was implemented: Created comprehensive stablecoin payments guide
- Files changed:
  - Created `examples/stablecoin-payments.mdx` - dedicated stablecoin payments documentation
  - Updated `docs.json` - added stablecoin-payments to Examples group (first position)
- **Learnings for future iterations:**
  - Examples pages should be placed at the top of their group in docs.json for visibility
  - use-cases/pay.mdx and examples/stablecoin-payments.mdx have some overlap but serve different purposes: use-cases is the "how" overview, examples is deep-dive with more code
  - CCTP (Circle Cross-Chain Transfer Protocol) is supported on Ethereum, Base, Arbitrum, Optimism, Polygon, Avalanche
  - Stablecoin contract addresses are chain-specific - include them for API integrations
  - Chain IDs reference: Ethereum=1, Base=8453, Arbitrum=42161, Optimism=10, Polygon=137, BNB=56, Avalanche=43114
  - AccordionGroup component is effective for "Best Practices" sections - keeps page scannable
  - Backend verification pattern should always be included for merchant integrations - never trust client-side alone
---

## 2026-01-21 - US-011
- What was implemented: Updated supported-chains.mdx with complete chain data from SDK source
- Files changed:
  - Rewrote `resources/supported-chains.mdx` - comprehensive chain support documentation
- **Learnings for future iterations:**
  - Chain data source of truth is `packages/0xtrails/src/chains.ts` - has `supportedSequenceChains` and `getAllChains()`
  - Etherlink chain ID is 42793 (mainnet), 128123 (testnet) - was missing from old docs
  - SDK supports 18 mainnet chains and 15 testnet chains
  - Token availability per chain can be found in `packages/0xtrails/src/tokens.ts` - look for USDC/USDT definitions
  - CCTP support: Ethereum, Base, Arbitrum, Optimism, Polygon, Avalanche
  - Prefer markdown tables over JSX components for chain lists - more maintainable and LLM-friendly
  - Include stablecoin contract addresses for API integrations (helps developers using direct API calls)
  - Organize chains by use case (low fee, high liquidity, gaming/NFT) for better discoverability
---

## 2026-01-21 - US-012
- What was implemented: Comprehensive rewrite of SDK configuration documentation with all TrailsWidget props
- Files changed:
  - Rewrote `sdk/configuration.mdx` - complete configuration reference with TypeScript types
- **Learnings for future iterations:**
  - TrailsWidgetProps interface is defined in `packages/0xtrails/src/widget/widget.tsx` starting at line 162
  - SDK exports TrailsWidgetRef interface with openModal(), closeModal(), isModalOpen for programmatic control
  - Default values: mode="pay", theme="light", slippageTolerance=0.05 (5%), debug=false
  - All callbacks receive a `sessionId` parameter to correlate events across the transaction lifecycle
  - TransactionState type is in `packages/0xtrails/src/transactions.ts` - includes status, hash, chainId, explorerUrl
  - TrailsProvider wraps SequenceHooksProvider and TrailsModalProvider - use it for apps with multiple widgets
  - TrailsConfig defaults are in `packages/0xtrails/src/constants.ts` (PROD_* and DEFAULT_* exports)
  - The `onramp` prop requires the separate `@0xtrails/onramp` package for fiat-to-crypto functionality
  - Debug mode can be enabled via prop or URL parameter `?debug=true`
---

## 2026-01-21 - US-013
- What was implemented: Comprehensive rewrite of gasless transactions guide with USDC/USDT fee examples
- Files changed:
  - Rewrote `examples/gasless.mdx` - complete gasless transactions documentation
- **Learnings for future iterations:**
  - Gasless implementation is in `packages/0xtrails/src/gasless.ts` (permit signatures) and `packages/0xtrails/src/transactionIntent/deposits/gaslessDeposit.ts` (deposit flow)
  - Paymaster integration is in `packages/0xtrails/src/paymasterSend.ts` - supports Alchemy, Pimlico, ZeroDev, Thirdweb
  - `getDoGasless()` in gaslessDeposit.ts determines when to use gasless flow based on token type and wallet
  - EIP-2612 permit signatures are used for token approvals without on-chain transactions
  - Smart contract wallets cannot use gasless (signature length validation in `validateGaslessSignature()`)
  - Sequence-waas wallet is explicitly excluded from gasless flow (`walletId === "sequence-waas"`)
  - Fee options are fetched via `gasFeeOptions` in quote response and displayed in FeeOptions component
  - When user selects null (native gas), non-gasless flow is triggered; ERC-20 selection triggers gasless
  - Paymaster uses ERC-4337 entry point at `0x0000000071727de22e5e9d8baf0edac6f37da032`
---
